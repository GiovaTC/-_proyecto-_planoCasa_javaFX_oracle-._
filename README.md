# -_proyecto-_planoCasa_javaFX_oracle-._
# _Proyecto:_PlanoCasa_JavaFX_Oracle :. 

<img width="1024" height="1024" alt="image" src="https://github.com/user-attachments/assets/6d014d63-dfed-445b-8a66-50be9acba76b" />  

Este proyecto ejemplo muestra c贸mo crear una aplicaci贸n Java (IntelliJ IDEA 2022) con interfaz gr谩fica usando **JavaFX** para dibujar planos simples de una casa y **registrar / cargar** la informaci贸n en una base de datos **Oracle 19c** v铆a JDBC .

El contenido incluye: README, scripts SQL, y las clases Java principales .

---

## Requisitos :

- IntelliJ IDEA (2022 or later)
- JDK 17+ (recomendado)
- JavaFX SDK compatible con tu JDK (descargar de Gluon/SDK correspondiente)
- Driver JDBC Oracle (ojdbc8.jar u ojdbc11.jar seg煤n JDK)
- Oracle 19c en ejecuci贸n (local o remota) con usuario/contrase帽a


## Estructura del proyecto (archivos incluidos en este documento) :

- README.md (este documento)
- sql/create_tables.sql
- src/com/plano/MainApp.java
- src/com/plano/DBUtil.java
- src/com/plano/model/House.java
- src/com/plano/model/Room.java
- src/com/plano/dao/HouseDAO.java
- src/com/plano/dao/RoomDAO.java

---

## sql/create_tables.sql :

```sql
-- Crear esquema simple para casas y habitaciones
CREATE TABLE HOUSES (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  NAME VARCHAR2(200) NOT NULL,
  ADDRESS VARCHAR2(400),
  CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE ROOMS (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  HOUSE_ID NUMBER NOT NULL,
  NAME VARCHAR2(200) NOT NULL,
  X NUMBER NOT NULL, -- posici贸n X en el plano (pixeles relativos)
  Y NUMBER NOT NULL, -- posici贸n Y
  WIDTH NUMBER NOT NULL,
  HEIGHT NUMBER NOT NULL,
  AREA NUMBER,
  CONSTRAINT FK_ROOM_HOUSE FOREIGN KEY (HOUSE_ID) REFERENCES HOUSES(ID) ON DELETE CASCADE
);

-- Inserts de ejemplo
INSERT INTO HOUSES (NAME, ADDRESS) VALUES ('Casa Modelo A', 'Calle Falsa 123');

-- Suponer que la ID generada sea 1, si no, consulta la id despu茅s del insert
INSERT INTO ROOMS (HOUSE_ID, NAME, X, Y, WIDTH, HEIGHT, AREA) VALUES (1, 'Sala', 20, 20, 300, 200, 60);
INSERT INTO ROOMS (HOUSE_ID, NAME, X, Y, WIDTH, HEIGHT, AREA) VALUES (1, 'Cocina', 340, 20, 200, 150, 30);
INSERT INTO ROOMS (HOUSE_ID, NAME, X, Y, WIDTH, HEIGHT, AREA) VALUES (1, 'Dormitorio', 20, 240, 260, 180, 46.8);
COMMIT;
```

---

## Instrucciones de configuraci贸n en IntelliJ :

1. Crea un nuevo proyecto Java sin m贸dulo (JavaFX funciona bien as铆 si configuras las `VM options`).
2. A帽ade las carpetas `src` y pega las clases Java en la estructura indicada.
3. Agrega librer铆as externas (Project Structure > Libraries):
   - `javafx-sdk/lib` (todos los jars necesarios)
   - `ojdbc8.jar` o `ojdbc11.jar` (driver Oracle)
4. Configura las `VM options` de ejecuci贸n (Run > Edit Configurations...):
   -agrega las opciones de JavaFX, por ejemplo (ajusta la ruta a tu SDK):
```
--module-path "C:\javafx-sdk-20\lib" --add-modules javafx.controls,javafx.fxml
```
5. Compila y ejecuta `MainApp`.

---

## C贸digo Java (archivos principales) :

### src/com/plano/DBUtil.java

```java
package com.plano;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DBUtil {
    // Ajusta seg煤n tu entorno
    private static final String URL = "jdbc:oracle:thin:@localhost:1521:ORCL"; // o "//host:1521/service"
    private static final String USER = "APP_USER"; // reemplazar
    private static final String PASS = "password"; // reemplazar

    static {
        try {
            // Cargar driver (opcional con JDBC 4+)
            Class.forName("oracle.jdbc.OracleDriver");
        } catch (ClassNotFoundException e) {
            System.err.println("No se encontr贸 el driver JDBC Oracle: " + e.getMessage());
        }
    }

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(URL, USER, PASS);
    }
}
```

---

### src/com/plano/model/House.java

```java
package com.plano.model;

import java.time.OffsetDateTime;
import java.util.ArrayList;
import java.util.List;

public class House {
    private Long id;
    private String name;
    private String address;
    private OffsetDateTime createdAt;
    private List<Room> rooms = new ArrayList<>();

    public House() {}

    public House(Long id, String name, String address) {
        this.id = id;
        this.name = name;
        this.address = address;
    }

    // getters y setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }
    public List<Room> getRooms() { return rooms; }
    public void setRooms(List<Room> rooms) { this.rooms = rooms; }
}
```

---

### src/com/plano/model/Room.java

```java
package com.plano.model;

public class Room {
    private Long id;
    private Long houseId;
    private String name;
    private double x;
    private double y;
    private double width;
    private double height;
    private double area;

    public Room() {}

    public Room(String name, double x, double y, double width, double height) {
        this.name = name;
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.area = width * height / 100.0; // ejemplo: convertir pixeles a m2 (simple)
    }

    // getters y setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public Long getHouseId() { return houseId; }
    public void setHouseId(Long houseId) { this.houseId = houseId; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public double getX() { return x; }
    public void setX(double x) { this.x = x; }
    public double getY() { return y; }
    public void setY(double y) { this.y = y; }
    public double getWidth() { return width; }
    public void setWidth(double width) { this.width = width; }
    public double getHeight() { return height; }
    public void setHeight(double height) { this.height = height; }
    public double getArea() { return area; }
    public void setArea(double area) { this.area = area; }
}
```

---

### src/com/plano/dao/HouseDAO.java

```java
package com.plano.dao;

import com.plano.DBUtil;
import com.plano.model.House;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class HouseDAO {

    public static Long save(House house) throws SQLException {
        String sql = "INSERT INTO HOUSES(NAME, ADDRESS) VALUES(?, ?)";
        try (Connection c = DBUtil.getConnection(); PreparedStatement ps = c.prepareStatement(sql, new String[]{"ID"})) {
            ps.setString(1, house.getName());
            ps.setString(2, house.getAddress());
            ps.executeUpdate();
            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) {
                    long id = rs.getLong(1);
                    house.setId(id);
                    return id;
                }
            }
        }
        return null;
    }

    public static List<House> findAll() throws SQLException {
        List<House> list = new ArrayList<>();
        String sql = "SELECT ID, NAME, ADDRESS FROM HOUSES ORDER BY ID";
        try (Connection c = DBUtil.getConnection(); PreparedStatement ps = c.prepareStatement(sql); ResultSet rs = ps.executeQuery()) {
            while (rs.next()) {
                House h = new House(rs.getLong("ID"), rs.getString("NAME"), rs.getString("ADDRESS"));
                list.add(h);
            }
        }
        return list;
    }
}
```

---

### src/com/plano/dao/RoomDAO.java

```java
package com.plano.dao;

import com.plano.DBUtil;
import com.plano.model.Room;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class RoomDAO {

    public static void save(Room room) throws SQLException {
        String sql = "INSERT INTO ROOMS(HOUSE_ID, NAME, X, Y, WIDTH, HEIGHT, AREA) VALUES(?, ?, ?, ?, ?, ?, ?)";
        try (Connection c = DBUtil.getConnection(); PreparedStatement ps = c.prepareStatement(sql, new String[]{"ID"})) {
            ps.setLong(1, room.getHouseId());
            ps.setString(2, room.getName());
            ps.setDouble(3, room.getX());
            ps.setDouble(4, room.getY());
            ps.setDouble(5, room.getWidth());
            ps.setDouble(6, room.getHeight());
            ps.setDouble(7, room.getArea());
            ps.executeUpdate();
            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) {
                    room.setId(rs.getLong(1));
                }
            }
        }
    }

    public static List<Room> findByHouseId(long houseId) throws SQLException {
        List<Room> list = new ArrayList<>();
        String sql = "SELECT ID, NAME, X, Y, WIDTH, HEIGHT, AREA FROM ROOMS WHERE HOUSE_ID = ? ORDER BY ID";
        try (Connection c = DBUtil.getConnection(); PreparedStatement ps = c.prepareStatement(sql)) {
            ps.setLong(1, houseId);
            try (ResultSet rs = ps.executeQuery()) {
                while (rs.next()) {
                    Room r = new Room();
                    r.setId(rs.getLong("ID"));
                    r.setHouseId(houseId);
                    r.setName(rs.getString("NAME"));
                    r.setX(rs.getDouble("X"));
                    r.setY(rs.getDouble("Y"));
                    r.setWidth(rs.getDouble("WIDTH"));
                    r.setHeight(rs.getDouble("HEIGHT"));
                    r.setArea(rs.getDouble("AREA"));
                    list.add(r);
                }
            }
        }
        return list;
    }
}
```

---

### src/com/plano/MainApp.java

```java
package com.plano;

import com.plano.dao.HouseDAO;
import com.plano.dao.RoomDAO;
import com.plano.model.House;
import com.plano.model.Room;
import javafx.application.Application;
import javafx.geometry.Insets;
import javafx.scene.Scene;
import javafx.scene.canvas.Canvas;
import javafx.scene.canvas.GraphicsContext;
import javafx.scene.control.*;
import javafx.scene.input.MouseButton;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;

import java.sql.SQLException;
import java.util.List;

public class MainApp extends Application {
    private Canvas canvas;
    private GraphicsContext gc;
    private House currentHouse;

    @Override
    public void start(Stage primaryStage) {
        primaryStage.setTitle("Plano de Casa - JavaFX + Oracle");

        BorderPane root = new BorderPane();

        canvas = new Canvas(800, 600);
        gc = canvas.getGraphicsContext2D();
        drawGrid();

        // Panel lateral para crear casa/habitaciones
        VBox side = new VBox(10);
        side.setPadding(new Insets(10));
        TextField houseName = new TextField();
        houseName.setPromptText("Nombre de la casa");
        TextField houseAddr = new TextField();
        houseAddr.setPromptText("Direcci贸n");
        Button btnCreateHouse = new Button("Crear Casa");

        ListView<String> housesList = new ListView<>();
        Button btnLoadHouses = new Button("Cargar casas");

        // Controles para agregar habitaci贸n (clic-drag en canvas tambi茅n disponible)
        TextField roomName = new TextField();
        roomName.setPromptText("Nombre habitaci贸n");
        Button btnAddRoom = new Button("A帽adir habitaci贸n (ejemplo)");

        side.getChildren().addAll(new Label("Casa:"), houseName, houseAddr, btnCreateHouse, btnLoadHouses, new Label("Casas guardadas:"), housesList,
                new Separator(), new Label("Habitaci贸n:"), roomName, btnAddRoom);

        HBox bottom = new HBox(10);
        bottom.setPadding(new Insets(10));
        Label info = new Label("Haz click-drag en el canvas para dibujar una habitaci贸n (bot贸n izquierdo).");
        bottom.getChildren().add(info);

        root.setCenter(canvas);
        root.setRight(side);
        root.setBottom(bottom);

        // Eventos
        btnCreateHouse.setOnAction(e -> {
            try {
                House h = new House();
                h.setName(houseName.getText());
                h.setAddress(houseAddr.getText());
                Long id = HouseDAO.save(h);
                h.setId(id);
                currentHouse = h;
                housesList.getItems().add(String.format("%d - %s", id, h.getName()));
                info.setText("Casa creada con id=" + id);
            } catch (SQLException ex) {
                info.setText("Error al crear casa: " + ex.getMessage());
            }
        });

        btnLoadHouses.setOnAction(e -> {
            housesList.getItems().clear();
            try {
                List<House> hs = HouseDAO.findAll();
                for (House h : hs) {
                    housesList.getItems().add(String.format("%d - %s", h.getId(), h.getName()));
                }
                info.setText("Casas cargadas: " + hs.size());
            } catch (SQLException ex) {
                info.setText("Error al cargar casas: " + ex.getMessage());
            }
        });

        housesList.setOnMouseClicked(ev -> {
            String sel = housesList.getSelectionModel().getSelectedItem();
            if (sel != null) {
                String[] parts = sel.split(" - ");
                try {
                    long id = Long.parseLong(parts[0]);
                    currentHouse = new House();
                    currentHouse.setId(id);
                    currentHouse.setName(parts[1]);
                    // cargar rooms
                    List<Room> rooms = RoomDAO.findByHouseId(id);
                    currentHouse.setRooms(rooms);
                    redrawRooms();
                    info.setText("Casa cargada: id=" + id + " con " + rooms.size() + " habitaciones");
                } catch (Exception ex) {
                    info.setText("Error al seleccionar casa: " + ex.getMessage());
                }
            }
        });

        // A帽adir habitaci贸n manual simple
        btnAddRoom.setOnAction(e -> {
            if (currentHouse == null || currentHouse.getId() == null) {
                info.setText("Primero crea o carga una casa.");
                return;
            }
            String rn = roomName.getText();
            if (rn == null || rn.isEmpty()) rn = "Habitaci贸n";
            Room r = new Room(rn, 50, 50, 200, 150);
            r.setHouseId(currentHouse.getId());
            try {
                RoomDAO.save(r);
                currentHouse.getRooms().add(r);
                redrawRooms();
                info.setText("Habitaci贸n guardada: " + rn);
            } catch (SQLException ex) {
                info.setText("Error guardando habitaci贸n: " + ex.getMessage());
            }
        });

        // Dibujo con mouse: click-drag para crear habitaci贸n
        final double[] start = new double[2];
        canvas.setOnMousePressed(ev -> {
            if (ev.getButton() == MouseButton.PRIMARY) {
                start[0] = ev.getX(); start[1] = ev.getY();
            }
        });
        canvas.setOnMouseReleased(ev -> {
            if (ev.getButton() == MouseButton.PRIMARY) {
                double endX = ev.getX(); double endY = ev.getY();
                double x = Math.min(start[0], endX);
                double y = Math.min(start[1], endY);
                double w = Math.abs(endX - start[0]);
                double h = Math.abs(endY - start[1]);
                // crear habitaci贸n
                if (w > 10 && h > 10 && currentHouse != null && currentHouse.getId() != null) {
                    Room r = new Room("Hab " + (currentHouse.getRooms().size() + 1), x, y, w, h);
                    r.setHouseId(currentHouse.getId());
                    try {
                        RoomDAO.save(r);
                        currentHouse.getRooms().add(r);
                        redrawRooms();
                        info.setText("Habitaci贸n creada y guardada: " + r.getName());
                    } catch (SQLException ex) {
                        info.setText("Error guardando habitaci贸n: " + ex.getMessage());
                    }
                }
            }
        });

        primaryStage.setScene(new Scene(root, 1100, 640));
        primaryStage.show();
    }

    private void drawGrid() {
        gc.clearRect(0,0, canvas.getWidth(), canvas.getHeight());
        // fondo
        gc.fillText("Plano (grid)", 10, 12);
        for (int x = 0; x < canvas.getWidth(); x += 20) {
            gc.strokeLine(x, 0, x, canvas.getHeight());
        }
        for (int y = 0; y < canvas.getHeight(); y += 20) {
            gc.strokeLine(0, y, canvas.getWidth(), y);
        }
    }

    private void redrawRooms() {
        drawGrid();
        if (currentHouse == null) return;
        gc.fillText("Casa: " + currentHouse.getName(), 10, 30);
        for (Room r : currentHouse.getRooms()) {
            gc.strokeRect(r.getX(), r.getY(), r.getWidth(), r.getHeight());
            gc.fillText(r.getName(), r.getX() + 5, r.getY() + 15);
            gc.fillText(String.format("%.1f m2", r.getArea()), r.getX() + 5, r.getY() + 30);
        }
    }

    public static void main(String[] args) {
        launch(args);
    }
}
```

---

## Notas y recomendaciones :

- Este proyecto es una base: para producci贸n deber铆as manejar transacciones, validaciones, mapping entre pixeles y medidas reales (m虏), escalas, UI m谩s rica (drag/move/resize de habitaciones), y modularizar.
- Ajusta `DBUtil.URL`, `USER`, `PASS` al entorno Oracle.
- Si usas `service_name` en Oracle la URL podr铆a ser: `jdbc:oracle:thin:@//host:1521/servicename`.
- Aseg煤rate que el usuario de la BD tenga permisos para crear tablas si piensas ejecutar `create_tables.sql` desde la app :. . / :. .

---

